<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% load static %}
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/objet-style.css' %}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon.png' %}">
    <link rel="apple-touch-icon" href="{% static 'img/favicon.png' %}">
    <title>{% block title %}Portail AB{% endblock %}</title>
    <style>
        @media print {
          /* Cacher les Ã©lÃ©ments inutiles lors de l'impression */
          iframe, button, nav{
            display: none !important;
          }
      
          /* Optimisation du contenu principal pour l'impression */
          body,.container {
            margin: 0;
            padding: 0;
            width: 100%;
          }
      
          /* Styles spÃ©cifiques pour les Ã©lÃ©ments imprimÃ©s */
          body {
            font-size: 14px;
            color: #000;
          }
          
          /* AmÃ©liorer la lisibilitÃ© pour les sections */
          section {
            page-break-inside: avoid;
            margin-bottom: 0px;
          }
         
        img {
            max-width: 100%;
            height: auto;
            object-fit: contain;
            }
        }
        /* Chrome, Safari, Edge */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
           }

        /* Firefox */
        input[type=number] {
        -moz-appearance: textfield;
        }
        input[name$="-ordre"] { display: none; }
        .ingredient-row {
            transition: opacity .2s ease;
        }
        #id_etapes {
                  background: transparent;
                  position: relative;
                  z-index: 10;
                }
      </style>
</head>
{% block extra_js %}{% endblock %}
<body class="bg-gray-100">
  <header>
    <nav class="bg-blue-500 text-white text-lg font-bold py-3">
    <div class="container mx-auto flex items-center justify-between px-4">
        <div class="flex items-center space-x-3">
            <a href="{% url 'home' %}" class="flex items-center">
                <img
                    src="{% static 'img/favicon.png' %}"
                    class="h-11 w-11 rounded-xl shadow-sm bg-white p-1"
                >
            </a>
            <a class="text-lg font-bold flex items-center" href="{% url 'home' %}">
                <i class="fas fa-home"></i>
            </a>
        </div>

        <!-- Bouton menu mobile -->
        <button id="menuToggle" class="lg:hidden text-white focus:outline-none">
            <span class="fas fa-bars"></span>
        </button>

        <!-- Menu Responsive -->
        <div id="menu" class="hidden flex flex-col lg:flex lg:flex-row lg:space-x-4 lg:relative lg:top-0 lg:w-auto absolute top-14 left-0 w-full bg-blue-500 text-white shadow-md py-2 lg:py-0">
            <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg" href="{% url 'objets:tableau_bord' %}">ğŸ“Š Tableau de Bord</a>
            <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg" href="{% url 'objets:liste_objets' %}">ğŸ›ï¸ Objets</a>
            <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg" href="{% url 'documents:liste_documents' %}">ğŸ“„ Documents</a>
    
          <!-- Sous-menu Photos -->
            <div class="relative group flex items-center">
                    <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg cursor-pointer" id="navbarDropdown2" href="#" role="button">
                        ğŸ“· Photos â¬‡
                    </a>
                    <ul class="absolute hidden group-hover:block bg-white text-gray-800 shadow-lg rounded-md mt-28 w-56">
                        <li><a class="block px-4 py-2 hover:bg-gray-100" href="{% url 'photos:gallery_list' %}">ğŸï¸ Galeries</a></li>
                        <li><a class="block px-4 py-2 hover:bg-gray-100" href="{% url 'photos:photo_list' %}">ğŸ“· Toutes les photos</a></li>
                    </ul>
            </div>

            <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg" href="{% url 'recettes:recettes' %}">ğŸ½ï¸ Cuisine</a>
            <a class="py-2 px-4 hover:bg-blue-600 block rounded-lg" href="{% url 'admin:index' %}" target="_blank">âš™ï¸ Gestion des donnÃ©es</a>       
        </div>

        <!-- Profil utilisateur -->
        <div class="flex items-center space-x-4">
            <div class="text-white font-bold">{{ user.username }}</div>
            <div class="relative group">
                <a class="text-white hover:text-gray-300" id="navbarDropdown" href="#" role="button">
                    <i class="fas fa-user fa-fw"></i>
                </a>
                <ul class="absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-md opacity-0 group-hover:opacity-100 transition-opacity">
                    <li><a href="{% url 'login' %}" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Se connecter</a></li>
                    <li>
                        <form method="post" action="{% url 'logout' %}">
                            {% csrf_token %}
                            <button type="submit" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100">Se dÃ©connecter</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

 </header>

<main class="container mx-auto p-4">
    {% block content %}
    {% endblock %}
</main>

<footer class="text-center py-4 bg-gray-200 mt-8">
    <p>Â© 2025 Portail AB</p>
</footer>

<script src="{% static 'js/fontawesome-all.min.js' %}"></script>
<script>
document.getElementById("add-ingredient").addEventListener("click", function () {
    const totalFormsInput = document.querySelector(
        'input[name="ingredients-TOTAL_FORMS"]'
    );

    const index = parseInt(totalFormsInput.value, 10);
    const template = document.getElementById("ingredient-empty-form").innerHTML;

    const html = template.replace(/__prefix__/g, index);

    document.getElementById("ingredient-list")
        .insertAdjacentHTML("beforeend", html);

    totalFormsInput.value = index + 1;
});
    const list = document.getElementById("ingredient-list");

new Sortable(list, {
    handle: ".cursor-move",
    animation: 150,
    onEnd: function () {
        document
            .querySelectorAll("#ingredient-list input[name$='-ordre']")
            .forEach((input, index) => {
                input.value = index;
            });
    }
});
</script>
<script>
<script>
document.addEventListener("click", function (e) {
    if (e.target.classList.contains("delete-ingredient")) {
        const row = e.target.closest(".ingredient-row");

        // coche DELETE
        const deleteInput = row.querySelector("input[name$='-DELETE']");
        if (deleteInput) {
            deleteInput.checked = true;
        }

        // masque visuellement
        row.style.display = "none";

        // recalcule lâ€™ordre
        updateOrdre();
    }
});

function updateOrdre() {
    document
        .querySelectorAll(
            "#ingredient-list .ingredient-row:not([style*='display: none']) input[name$='-ordre']"
        )
        .forEach((input, index) => {
            input.value = index;
        });
}
row.style.opacity = 0.4;

</script>
</body>
</html>
